<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Multilevel Platformer</title>
  <style>
    body { margin: 0; overflow: hidden; background: linear-gradient(skyblue, lightgreen); }
    canvas { display: block; margin: 0 auto; background: #87ceeb; }
    #controls { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); display: flex; gap: 10px; }
    .btn { width: 60px; height: 60px; background: rgba(0,0,0,0.5); color: white; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 24px; user-select: none; touch-action: none; }
  </style>
</head>
<body>
  <canvas id="game" width="800" height="450"></canvas>
  <div id="controls">
    <div class="btn" id="left">⟵</div>
    <div class="btn" id="right">⟶</div>
    <div class="btn" id="jump">⤒</div>
  </div>
<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let keys = { left:false, right:false, jump:false };

class Player {
  constructor(){
    this.x=50; this.y=0; this.w=30; this.h=30;
    this.vx=0; this.vy=0;
    this.speed=0.4; this.maxSpeed=4;
    this.jumpStrength=9; this.onGround=false;
    this.lives=3; this.score=0;
    this.respawnX=50; this.respawnY=0;
  }
  update(){
    if(keys.left) this.vx -= this.speed;
    if(keys.right) this.vx += this.speed;
    if(!keys.left && !keys.right){
      this.vx *= 0.8; // friction
    }
    if(this.vx>this.maxSpeed) this.vx=this.maxSpeed;
    if(this.vx<-this.maxSpeed) this.vx=-this.maxSpeed;

    this.vy += 0.5; // gravity
    this.x += this.vx;
    this.y += this.vy;

    // collisions
    this.onGround=false;
    for(let p of levels[currentLevel].platforms){
      if(this.x < p.x+p.w && this.x+this.w > p.x && this.y+this.h < p.y+20 && this.y+this.h+this.vy >= p.y){
        this.y = p.y - this.h;
        this.vy = 0;
        this.onGround=true;
      }
    }
    // spikes
    for(let s of levels[currentLevel].spikes){
      if(this.x < s.x+s.w && this.x+this.w > s.x && this.y < s.y+s.h && this.y+this.h > s.y){
        this.die();
      }
    }
    // enemies
    for(let e of levels[currentLevel].enemies){
      if(this.x < e.x+e.w && this.x+this.w > e.x && this.y < e.y+e.h && this.y+this.h > e.y){
        if(this.vy>0){ // stomp
          e.dead=true; this.vy=-8;
        } else {
          this.die();
        }
      }
    }
    // coins
    for(let c of levels[currentLevel].coins){
      if(!c.collected && this.x < c.x+20 && this.x+this.w > c.x && this.y < c.y+20 && this.y+this.h > c.y){
        c.collected=true; this.score++;
      }
    }
    // win check
    if(levels[currentLevel].coins.every(c=>c.collected)){
      currentLevel++;
      if(currentLevel>=levels.length){
        alert("You win!");
        currentLevel=0; this.reset();
      } else {
        this.respawnX=50; this.respawnY=0;
        this.x=50; this.y=0; this.vx=0; this.vy=0;
      }
    }
    if(this.y>canvas.height+100){ this.die(); }
  }
  jump(){ if(this.onGround){ this.vy=-this.jumpStrength; this.onGround=false; } }
  die(){
    this.lives--;
    canvas.classList.add("flash");
    setTimeout(()=>canvas.classList.remove("flash"),100);
    if(this.lives<=0){
      alert("Game Over"); this.reset();
    } else {
      this.x=this.respawnX; this.y=this.respawnY; this.vx=0; this.vy=0;
    }
  }
  reset(){ this.lives=3; this.score=0; currentLevel=0; this.x=50; this.y=0; this.vx=0; this.vy=0; }
  draw(){
    ctx.fillStyle="red";
    ctx.fillRect(this.x,this.y,this.w,this.h);
    ctx.fillStyle="white";
    ctx.fillRect(this.x+5,this.y+8,5,5);
    ctx.fillRect(this.x+20,this.y+8,5,5);
  }
}

class Enemy{
  constructor(x,y){ this.x=x; this.y=y; this.w=30; this.h=30; this.vx=2; this.dead=false; }
  update(){ if(this.dead) return; this.x+=this.vx; if(this.x<0||this.x+this.w>canvas.width) this.vx*=-1; }
  draw(){ if(this.dead) return; ctx.fillStyle="blue"; ctx.fillRect(this.x,this.y,this.w,this.h); }
}

function makeLevel(platforms,coins,enemies,spikes){ return {platforms,coins,enemies,spikes}; }

let levels=[
  makeLevel([{x:0,y:400,w:800,h:50}], [{x:200,y:360,collected:false}], [new Enemy(400,370)], [{x:600,y:380,w:30,h:20}]),
  makeLevel([{x:0,y:400,w:800,h:50},{x:200,y:300,w:100,h:20}], [{x:210,y:260,collected:false},{x:500,y:360,collected:false}], [new Enemy(500,370)], [{x:300,y:380,w:30,h:20}]),
  makeLevel([{x:0,y:400,w:800,h:50},{x:150,y:330,w:100,h:20},{x:350,y:260,w:100,h:20}], [{x:160,y:290,collected:false},{x:360,y:220,collected:false}], [new Enemy(600,370)], [{x:450,y:380,w:30,h:20}]),
  makeLevel([{x:0,y:400,w:800,h:50},{x:250,y:300,w:100,h:20},{x:500,y:200,w:100,h:20}], [{x:260,y:260,collected:false},{x:510,y:160,collected:false}], [new Enemy(300,270)], [{x:600,y:380,w:30,h:20}]),
  makeLevel([{x:0,y:400,w:800,h:50},{x:200,y:320,w:100,h:20},{x:400,y:240,w:100,h:20},{x:600,y:160,w:100,h:20}], [{x:210,y:280,collected:false},{x:410,y:200,collected:false},{x:610,y:120,collected:false}], [new Enemy(700,370)], [{x:500,y:380,w:30,h:20}])
];

let currentLevel=0;
let player=new Player();

function loop(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  player.update();
  for(let p of levels[currentLevel].platforms){ ctx.fillStyle="brown"; ctx.fillRect(p.x,p.y,p.w,p.h); }
  for(let s of levels[currentLevel].spikes){ ctx.fillStyle="black"; ctx.beginPath(); ctx.moveTo(s.x,s.y+s.h); ctx.lineTo(s.x+s.w/2,s.y); ctx.lineTo(s.x+s.w,s.y+s.h); ctx.closePath(); ctx.fill(); }
  for(let c of levels[currentLevel].coins){ if(!c.collected){ ctx.fillStyle="gold"; ctx.beginPath(); ctx.arc(c.x+10,c.y+10,10,0,Math.PI*2); ctx.fill(); ctx.stroke(); } }
  for(let e of levels[currentLevel].enemies){ e.update(); e.draw(); }
  player.draw();
  ctx.fillStyle="black"; ctx.fillText("Lives: "+player.lives,10,20); ctx.fillText("Score: "+player.score,10,40); ctx.fillText("Level: "+(currentLevel+1),10,60);
  requestAnimationFrame(loop);
}
loop();

// keyboard
window.addEventListener("keydown",e=>{ if(e.code==="ArrowLeft"||e.code==="KeyA") keys.left=true; if(e.code==="ArrowRight"||e.code==="KeyD") keys.right=true; if(e.code==="Space"||e.code==="ArrowUp"||e.code==="KeyW"){ keys.jump=true; player.jump(); } });
window.addEventListener("keyup",e=>{ if(e.code==="ArrowLeft"||e.code==="KeyA") keys.left=false; if(e.code==="ArrowRight"||e.code==="KeyD") keys.right=false; if(e.code==="Space"||e.code==="ArrowUp"||e.code==="KeyW") keys.jump=false; });

// touch controls
function bindBtn(id,action){
  let btn=document.getElementById(id);
  btn.addEventListener("pointerdown",()=>{ keys[action]=true; if(action==="jump") player.jump(); });
  btn.addEventListener("pointerup",()=>{ keys[action]=false; });
  btn.addEventListener("pointerleave",()=>{ keys[action]=false; });
  btn.addEventListener("pointercancel",()=>{ keys[action]=false; });
}
bindBtn("left","left");
bindBtn("right","right");
bindBtn("jump","jump");

</script>
<style>
#game.flash { animation: flashAnim 0.2s; }
@keyframes flashAnim { from{background:red;} to{background:skyblue;} }
</style>
</body>
</html>
